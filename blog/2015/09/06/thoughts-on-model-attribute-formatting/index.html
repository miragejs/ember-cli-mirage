<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Thoughts on model attribute formatting &middot; Ember CLI Mirage
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/style.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <div class="Topbar">
      <div class="Container">
      </div>
    </div>

    <header class="Header">
  <div class="Container">
    <nav class='Header__nav'>
      <ul class='Header__nav-list'>
        <li class='Header__nav-item'>
          <a href='/docs/v0.4.x' class="Header__nav-item-link">
            <span class="u-mobile">Docs</span>
            <span class="u-desktop">Documentation</span>
          </a>
        </li>
        <li class='Header__nav-item'>
          <a href='/blog' class="Header__nav-item-link active">Blog</a>
        </li>
        <li class='Header__nav-item'>
          <a href='/about' class="Header__nav-item-link">About</a>
        </li>
        <li class='Header__nav-item'>
          <a href="https://github.com/samselikoff/ember-cli-mirage" class='Header__nav-item-link' target="_blank">GitHub</a>
        </li>
      </ul>
    </nav>
    <a class="Header__logo" href="/">
      <span class='Header__logo-minor'>Ember CLI</span><br>
      <span class='Header__logo-major'>Mirage</span>
    </a>
  </div>
</header>


    <div class="Wrapper">
      <div class="Content">
        <div class="Blog">
  <div class='Blog__post'>
    <div class="Blog__post-info">
      <h1 class='Blog__title'>Thoughts on model attribute formatting</h1>
      <p class='Blog__byline'>September 6, 2015</p>
      <hr class='Blog__divider'>
    </div>
    <div class='Blog__content'>
      <p>I ran into an interesting problem while working on the serializer layer. I was just wrapping up AMS-style responses and was going to start working on the JSON:API version, when a wrinkle came up: the formatting of attribute names, both on Mirage’s model layer instances, and on the field names of Mirage’s database.</p>

<p>Currently, Mirage’s database simply takes whatever POJO of attrs you give it, and sticks that in its db. So if you write</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">first_name</span><span class="p">:</span> <span class="s1">'Link'</span> <span class="p">})</span>
</code></pre></div></div>

<p>then you’ll end up with that POJO in the db, but if you use <code class="highlighter-rouge">first-name</code>, you’ll get that instead. This was originally done to make things as simple as possible - your db fields matched your API responses, so fixtures would “just work”, and accessing the data is as you’d expect based on your API.</p>

<p>When I introduced the model layer, I added attr accessors that simply matched the keys in the db. But right now, it’s a naive implementation that just wraps the db attrs. So, if you’re working with a <code class="highlighter-rouge">user</code> model (e.g. in your route handler), you would either access <code class="highlighter-rouge">user.first_name</code> or <code class="highlighter-rouge">user['first-name']</code>, depending on how your database looked.</p>

<p>It seems like attrs on models should be consistently camelCase. One would expect to write <code class="highlighter-rouge">user.firstName</code> on a JavaScript model. That’s the convention. I <em>could</em> keep the model’s attrs in the format of your API (i.e. whatever’s in your db), so we’d have something like <code class="highlighter-rouge">user.first_name</code>. But, what happens when you switch your app over to JSON:API? Now, you have to rewrite all the custom parts of your Mirage server, since it’s now <code class="highlighter-rouge">user['first-name']</code> in JSON:API. That’s pretty crappy. Not to mention, the dynamic methods added by the model layer, like <code class="highlighter-rouge">user.createPost</code>, should probably be consistent across API formats.</p>

<p>So, I think models should have camelCase attributes. That way you’re always using camelCase, regardless of the format of your API - which makes sense, since you’re writing a (mock) JavaScript server.</p>

<p>This presents an interesting challenge. How should the db fields be formatted? There’s three ways to create db data. Fixture files, factories, and using the ORM in a route handler (e.g. <code class="highlighter-rouge">schema.user.create(...)</code>). The latter two seem like they should be camelCase (again, you don’t want to have to update all your factories if you change from AMS to JSON:API…you may have to update some parts of your routes). But fixtures should always “just work”.</p>

<p>This leads me to think there should be a part of the “serializer layer” that can deserialize an API payload and get the attrs for the model(s), or at least in some way standardize it. This would mean if you change your API, you’d be able to use new fixture files just by specifying your new serializer. Also, it’d make the shorthands more versatile - they could basically use your serializers to deserialize the payload, and then they’d be able to create/update/delete the appropriate models regardless of your API format. Right now, they are coupled to AMS-style responses.</p>

<p>I’ll have to think more about this, but right now this feels like the right move.</p>

      
      <div id="disqus_thread"></div>
    </div>
  </div>
</div>


<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//emberclimirage.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      </div>
    </div>

    <footer class="Footer">
  <div class="Container Grid Grid--gutters Grid--full med-Grid--fit">
    <div class="Grid-cell">
      <p>Project and site maintained by <a href="https://twitter.com/samselikoff">Sam Selikoff</a> and <a href="https://github.com/samselikoff/ember-cli-mirage/graphs/contributors">contributors</a>.</p>
      <p>Sponsored by <a href="https://embermap.com/">EmberMap</a>.<p>
    </div>
    <div class="Grid-cell">
      <div class="Github-stars">
        <iframe src="https://ghbtns.com/github-btn.html?user=samselikoff&repo=ember-cli-mirage&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js"></script>
<script>
  /* global anchors */
  // anchors.options = {
  //   placement: 'left',
  //   visible: 'always'
  // };
  anchors.add('h2:not(.Home-page__feature-heading)');
</script>


  </body>
</html>
